<!DOCTYPE html>
<html>
<head>
  <title>StarBuilder - editor</title>
  <script type="text/javascript" src="https://connor.ct.ws/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=FCwV_4DlZCt9mBnkfCiPW7UrAgrcbIUE8PIIS-c4aiFkjdNMHO2hfqFi2U1U4PQRTgATD-xUq8Gg3mUX5DK2-3-qIwnC7Vjz3aYsX1kZF4jXQ29CD2RhlYETNLubSgxeYGo-ZsbiSOWOWCmO8xhZdct_wi5YiOM-WQnOHQKi1sZp2_ZRPSlYpsajFTNvo43vrtmVUZ3-apnJI6hT7xYpHFgN5YG4jw_gBI8sx-br601LYP5l8TNVFqMfpFjOBX_AxApOs8ii7tX3KJPs_ACAag" charset="UTF-8"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f8f9fa;} .frame {background-color: #c0ff85; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.4); max-width: 400px; margin: 50px auto; flex-grow: 1;} .frame h1 {text-align: center; color: #333; margin-bottom: 30px;} .frame input[type="text"], .frame input[type="color"], .frame textarea, .frame select {width: 100%; padding: 12px 20px; margin: 8px 0; resize: vertical; display: inline-block; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; font-family: 'Roboto', sans-serif; box-shadow: 0 0 5px rgba(0, 0, 0, 0.4);} #blocks {background-color: #c0ff85; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.4); max-width: 400px; margin: 50px auto; flex-grow: 1; overflow-y: auto;} #blocks h1 {text-align: center; color: #333; margin-bottom: 30px;} #blocks p {color: #333; font-size: 20px; margin-bottom: 10px; text-align: center;} .checkbox-container {display: block; position: relative; padding-left: 35px; cursor: pointer; font-size: 16px; user-select: none;} .checkbox-container input {position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0;} .checkmark {position: absolute; top: 0; left: 0; height: 25px; width: 25px; background-color: #eee; border-radius: 5px;} .checkbox-container:hover input ~ .checkmark {background-color: #ccc;} .checkbox-container input:checked ~ .checkmark {background-color: #fff70a;} .checkmark:after {content: ""; position: absolute; display: none;} .checkbox-container input:checked ~ .checkmark:after {display: block;} .checkbox-container .checkmark:after {left: 9px; top: 5px; width: 5px; height: 10px; border: solid white; border-width: 0 3px 3px 0; transform: rotate(45deg);} .modal {display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);} .modal-content {background-color: white; margin: 10% auto; padding: 0; width: 300px; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.3);} .modal-header {background-color: #ffeb3b; color: black; padding: 15px; font-size: 18px; font-weight: bold; text-align: center; position: relative;} .close {position: absolute; right: 10px; top: 10px; font-size: 20px; cursor: pointer;} .modal-body {padding: 20px; display: flex; flex-direction: column; gap: 10px;} label {font-weight: bold;} input[type="text"], select {padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; width: 100%; box-sizing: border-box;} body button {margin-top: 10px; background-color: #ffeb3b; border: none; padding: 10px; font-weight: bold; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.2s;} body button:hover {transform: scale(1.03);}
.custom-alert-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; } .custom-alert-box { background: white; padding: 20px 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); font-family: Arial, sans-serif; text-align: center; max-width: 90%; width: 300px; } .ai { background: linear-gradient(to bottom, #ea00ff, #00bfff); color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; } .tab-container {display: flex; border-bottom: 2px solid #ccc; margin-bottom: 10px;} .tab {padding: 12px 24px; cursor: pointer; background-color: #e9ecef; border: 1px solid #ccc; border-bottom: none; margin-right: 5px; border-radius: 10px 10px 0 0; transition: background-color 0.3s, color 0.3s;} .tab:hover {background-color: #dee2e6;} .tab.active {background-color: white; font-weight: bold; color: #000; border-top: 3px solid #007bff;} .tab-content {border: 1px solid #ccc; padding: 20px; background-color: white; border-radius: 0 0 10px 10px; animation: fadeIn 0.3s ease-in-out;} .tab-content.hidden {display: none;} @keyframes fadeIn {from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);}}
.tab-container button { background: transparent; border: none; color: inherit; padding: 0; margin: 0; font: inherit; cursor: pointer; outline: none; box-shadow: none; text-shadow: none; }
</style>
</head>
<body>
      <div id="inputModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      Add New Input
      <span class="close" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <label for="inputId">ID:</label>
      <input type="text" id="inputName" placeholder="ID">

      <label for="inputType">Type:</label>
      <select id="inputType">
      <option value="STRING">String</option>
      <option value="NUMBER">Number</option>
      <option value="BOOLEAN">Boolean</option>
      <option value="COLOR">Color</option>
      <option value="COSTUME">Costume</option>
      <option value="SOUND">Sound</option>
      <option value="ANGLE">Angle</option>
      <option value="MATRIX">Matrix</option>
      <option value="NOTE">Note</option>
      <option value="empty">Empty</option>
      </select>

      <label for="inputDefault">Input Default:</label>
      <input type="text" id="inputDefault" placeholder="Hello, world!">

      <button class="add-input-btn" onclick="addInput()">+ Add Input</button>
    </div>
  </div>
</div>
    <script>
  function openModal() {
    document.getElementById("inputModal").style.display = "block";
  }

  function closeModal() {
    document.getElementById("inputModal").style.display = "none";
  }
</script>
  
  <div class="tab-container">
    <div class="tab active" data-tab="1">Blocks</div>
    <div class="tab" data-tab="2">Category</div>
    <div class="tab" data-tab="3">Menus</div>
    <img src="https://raw.githubusercontent.com/AlmejasHub/StarBuilder/refs/heads/main/editor/StarBuilderB.svg" width="5%"></img><h3>ㅤStarBuilderㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ</h3><button onclick="save()">ㅤSaveㅤ</button><button onclick="load()">ㅤLoadㅤ</button><button onclick="end()">ㅤExportㅤ</button>
  </div>

  <div class="tab-content" id="content-1">
    <h2>Block</h2><button onclick="openModal()">Add Input</button>
    <p>Name:<input type="text" id="Name"></p>
    <p>ID:<input type="text" id="ID"></p>
    <p>Type: <select id="Type">
      <option value="COMMAND">Block</option>
      <option value="REPORTER">Reporter</option>
      <option value="BOOLEAN">Boolean</option>
    </select></p>
    <label class="checkbox-container">
      <input type="checkbox" id="Monitor" checked>
      <span class="checkmark"></span>
      Disable Monitor?
    </label>
    <p>JavaScript:<textarea placeholder="JavaScript Here..." id="JS"></textarea></p>
    <button onclick="add()">Add Block</button>
    <button class="ai" onclick="generateJS()" id="generateWithAI">Generate JS with AI (Soon!)</button>
    
  </div>
  <div class="tab-content hidden" id="content-2">Contenido de la pestaña 2</div>
  <div class="tab-content hidden" id="content-3">Contenido de la pestaña 3</div>
  <script>
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabNumber = tab.dataset.tab;

        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        contents.forEach(content => {
          content.classList.add('hidden');
        });

        const selectedContent = document.getElementById(`content-${tabNumber}`);
        selectedContent.classList.remove('hidden');
      });
    });
  </script>
  <script>
let blocks = "";
let inputsArray = [];
const fileInput = document.getElementById('fileInput');
let unlockedAI = false;

function addInput() {
  const inputInputName = document.getElementById("inputName").value;
  const inputInputType = document.getElementById("inputType").value;
  const inputInputDefault = document.getElementById("inputDefault").value;

  const inputObject = `"${inputInputName}": {
    type: Scratch.ArgumentType.${inputInputType},
    defaultValue: "${inputInputDefault}"
  }`;

  inputsArray.push(inputObject);
  StarAlert("Input Added");
  closeModal();
}

function UnlockAI() {
    document.getElementById('generateWithAI').textContent = "Generate JS with AI";
    unlockedAI = true;
}

function add() {
  const inputName = document.getElementById("Name").value;
  const inputID = document.getElementById("ID").value;
  const inputJS = document.getElementById("JS").value;
  const inputType = document.getElementById("Type").value;
  const inputMonitor = document.getElementById("Monitor").checked;

  const inputs = inputsArray.join(',\n');

  blocks += `
    blocks.push({
      opcode: "${inputID}",
      blockType: Scratch.BlockType.${inputType},
      text: "${inputName}",
      arguments: {${inputs}},
      disableMonitor: ${inputMonitor},
      isEdgeActivated: false
    });

    Extension.prototype["${inputID}"] = async (args, util) => {
      ${inputJS}
    };
  `;

  document.getElementById("blockslist").innerHTML += `[${inputType == "COMMAND" ? "BLOCK" : inputType == "REPORTER" ? "Reporter" : inputType == "BOOLEAN" ? "Boolean" : "UNKNOWN"}] ${inputName}<br>`;
  inputsArray = [];
}

function save() {
  const EXTNAME = document.getElementById("EXT").value;
  const code = `README: This file is not meant to be opened! Please do not change anything.  
--BLOCKSVAR:START--${blocks}--BLOCKSVAR:END--
--BLOCKSHTML:START--${document.getElementById("blockslist").innerHTML}--BLOCKSHTML:END--`;
  const codeBlob = new Blob([code], { type: 'application/javascript' });
  const downloadLink = document.createElement('a');
  downloadLink.href = URL.createObjectURL(codeBlob);
  downloadLink.download = `${EXTNAME}.sb`;
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}

function getContentBetween(startString, stopString, inputString) {
    // Check if inputString is defined and is a string
    if (typeof inputString !== 'string') {
        console.error('inputString must be a valid string');
        return "";
    }

    // Find the indices of startString and stopString
    const start = inputString.indexOf(startString);
    const end = inputString.indexOf(stopString);

    // Ensure that the start and end indices are valid
    if (start === -1 || end === -1 || end <= start + startString.length) {
        console.warn('Start or stop string not found or in the wrong order');
        return "";
    }

    // Extract and return the content between the start and stop strings
    return inputString.slice(start + startString.length, end).trim();
}

function load() {
  fileInput.click();
}

fileInput.addEventListener('change', (event) => {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const fileContent = e.target.result;
      blocks = getContentBetween('--BLOCKSVAR:START--', '--BLOCKSVAR:END--', fileContent);
      document.getElementById('blockslist').innerHTML = getContentBetween('--BLOCKSHTML:START--', '--BLOCKSHTML:END--', fileContent);
      alert('The extension has loaded.')
    };
    reader.onerror = (e) => {
      alert("Something went wrong while reading this file.")
    }
    reader.readAsText(file);
  }
})

function end() {
  const EXTNAME = document.getElementById("EXT").value;
  const EXTID = document.getElementById("EXTID").value;
  const EXTCOLOR = document.getElementById("EXTCOLOR").value;
  const EXTCOLOR2 = document.getElementById("EXTCOLOR2").value;

  const code = `
  /*
  Made With StarBuilder! 🌟
  https://star-builder.vercel.app
  */
(async function(Scratch) {
  let blocks = [];

  if (!Scratch.extensions.unsandboxed) {
    alert("${EXTNAME} has to be run unsandboxed!");
    return;
  }

  class Extension {
    getInfo() {
      return {
        id: "${EXTID}",
        name: "${EXTNAME}",
        color1: "${EXTCOLOR}",
        color2: "${EXTCOLOR2}",
        blocks: blocks
      };
    }
  }

  ${blocks}

  Scratch.extensions.register(new Extension());
})(Scratch);
`;

  const codeBlob = new Blob([code], { type: 'application/javascript' });
  const downloadLink = document.createElement('a');
  downloadLink.href = URL.createObjectURL(codeBlob);
  downloadLink.download = `${EXTNAME}.js`;
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
};

  async function generateJS() {
    if (unlockedAI == "true") {
        const extra = prompt("AI will see type of the block and name. Enter any extra details below.");
        if (extra == null) {
            const blockType = document.getElementById("Type").value;
            const blockName = document.getElementById("Name").value;

            fetch('https://ai.aerioncloud.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer 1a243c046d7f496fa52a6dd5f411eb5a', // old shit (its not working anymore and i used a paid thing)
            },
            body: JSON.stringify({ messages: [{role: "user", content: `Generate JS code for my scratch block of type ${blockType}. If its not command, include a "return" statement. The name is "${blockName}". Use "args['INPUT ID']" where "INPUT ID" is ID of an input, content of which you want to get for inputs like [INPUT ID]. Inputs are visualized with "[INPUT ID]" in block's name where INPUT ID is id of an actual input. You can add more than 1 line to the code. You can use things like fetch etc. Respond only with generated code. Generate code ONLY for how block works. There is no defineBlock function etc. But you should NOT add this in a code block unlike me ok? Example for how the "[number1] + [number 2]" block works:
        \`\`\`js
        return args['number1'] + args['number2'];
        \`\`\``}], model: "gpt-4o" }),
            })
            .then(res => res.json())
            .then(data => document.getElementById('JS').value = data.choices[0].message.content.replace(/```js/g, '```').replace(/```/g, ''))
            .catch(console.error);
        } else {
            const blockType = document.getElementById("Type").value;
            const blockName = document.getElementById("Name").value;

            fetch('https://api.penguinai.tech/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer 1a243c046d7f496fa52a6dd5f411eb5a', // Replace with your API key
            },
            body: JSON.stringify({ messages: [{role: "user", content: `Generate JS code for my scratch block of type ${blockType}. If its not command, include a "return" statement. The name is "${blockName}". Use "args['INPUT ID']" where "INPUT ID" is ID of an input, content of which you want to get for inputs like [INPUT ID]. Inputs are visualized with "[INPUT ID]" in block's name where INPUT ID is id of an actual input. You can add more than 1 line to the code. You can use things like fetch etc. Respond only with generated code. Generate code ONLY for how block works. There is no defineBlock function etc. But you should NOT add this in a code block unlike me ok? Some extra details: ${extra}. Example for how the "[number1] + [number 2]" block works:
        \`\`\`js
        return args['number1'] + args['number2'];
        \`\`\``}], model: "gpt-4o" }),
            })
            .then(res => res.json())
            .then(data => document.getElementById('JS').value = data.choices[0].message.content.replace(/```js/g, '```').replace(/```/g, ''))
            .catch(console.error);
        }
    }
  }

    window.addEventListener("beforeunload", (event) => {
    event.preventDefault();
    event.returnValue = "Are you sure to exit StarBuilder?";
});

  function StarAlert(text) {
    const overlay = document.createElement('div');
    overlay.className = 'custom-alert-overlay';

    const alertBox = document.createElement('div');
    alertBox.className = 'custom-alert-box';

    const message = document.createElement('p');
    message.textContent = text;
    alertBox.appendChild(message);

    const button = document.createElement('button');
    button.textContent = 'Close';
    button.onclick = () => document.body.removeChild(overlay);
    alertBox.appendChild(button);

    overlay.appendChild(alertBox);
    document.body.appendChild(overlay);
  }

      const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabNumber = tab.dataset.tab;

        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        contents.forEach(content => {
          content.classList.add('hidden');
        });

        const selectedContent = document.getElementById(`content-${tabNumber}`);
        selectedContent.classList.remove('hidden');
      });
    });
  </script>
</body>
</html>
